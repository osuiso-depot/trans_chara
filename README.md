---

# 📘 キャラクター翻訳辞書自動生成ツール 仕様書（統合版）

---

## 🎯 目的

アニメ・ゲームキャラクターの英語表記（タグ名）を、正しい日本語表記へ自動翻訳するための辞書ファイルを構築する。
翻訳は主に **Danbooru API を活用したデータ処理**によって、AI翻訳による誤訳や表記揺れを防止する。

---

## 📁 設定ファイル（`config.yaml`）

本ツールの各種設定は、YAML形式の設定ファイルにより制御される。

```yaml
# AIタグ翻訳システム設定ファイル
# ◆Character用(仮)

# ファイル設定
files:
  input_file: "split_genres/genre_4_test.txt"   # 入力ファイルのパス
  output_file: "translated_tags_4_general.txt"  # 出力ファイルのパス
  failed_file: "translated_tags_4_general_failed.txt"  # 失敗ファイルのパス

# 処理設定
processing:
  batch_size: 10  # バッチサイズ
  sleep_sec: 0.3  # Danbooru APIアクセス間隔（秒）

# Danbooru設定
danbooru:
  username: "---"  # Danbooruユーザー名
  api_key: "---"   # Danbooru APIキー
```

---

## 📥 入力ファイル

### ファイル名（※configで指定）：

例：`split_genres/genre_4_test.txt`

### フォーマット（CSV形式）

1行につき1キャラクター情報を含む。

| 英語名（タグ） | ジャンル | 使用数 | 関連タグ |
| ------- | ---- | --- | ---- |

#### 入力例：

```
hatsune_miku,4,106634,/hm
kasane_teto,4,7148,
tainaka_ritsu,4,7229,
```

---

## 📤 出力ファイル

### ファイル名（※configで指定）：

例：`translated_tags_4_general.txt`

### フォーマット（CSV）

元データに「日本語訳」を追加した形式：

| 英語名 | 日本語名 | ジャンル | 使用数 | 関連タグ |
| --- | ---- | ---- | --- | ---- |

#### 出力例：

```
hatsune_miku,初音ミク,4,106634,/hm
kasane_teto,重音テト,4,7148,
tainaka_ritsu,田井中律,4,7229,
```

* `csv.writer` により安全な出力処理を行う。
* 日本語名が取得できなかった場合は空欄のままでよく、該当行はログに記録する。

---

## 🔍 翻訳方法の優先順位

| 優先 | 手段           | 内容                                        |
| -- | ------------ | ----------------------------------------- |
| ①  | Danbooru API | `danbooru.wiki` の `other_names` フィールドから取得 |
| ②  | AI翻訳        | 候補が複数ある場合、AIにより最適な名前を選択             |

---

## 🧠 処理フロー

1. `config.yaml` を読み込み、各種パスと認証情報を取得
2. 入力ファイル（CSV）を1行ずつ読み込み
3. 英語タグ（例：`kasane_teto`）を整形（例：`Kasane Teto`）し、検索用に加工
4. Danbooru API に認証付きでアクセスし、`other_names` を取得
5. 日本語名候補をスコアリングし、最適な名前を選定
   - 括弧付きの名前を優先
   - スコアリング基準に基づき最適な候補を選択
6. 候補が複数ある場合はAI翻訳を使用して最適な名前を選択
7. 翻訳結果を出力ファイルに書き込み
8. 翻訳失敗時は失敗ファイルに記録
9. バッチ処理を行い、API制限に配慮しつつ処理を継続
10. 全行の処理が完了するまで繰り返し

---

## 🔧 使用ライブラリ・技術要素

| 分類    | ツール                | 用途                 |
| ----- | ------------------ | ------------------ |
| 設定読込  | `yaml`             | config.yamlの読込     |
| CSV処理 | `csv`              | ファイルの安全な読み書き       |
| Web通信 | `requests`         | Danbooru APIへのアクセス |
| 認証    | `danbooru_auth`（仮） | APIキーによるアクセス制御     |
| AI翻訳  | `openai`（仮）       | AIによる翻訳候補選択       |
| 制限対策  | `time.sleep()`     | アクセス間隔調整           |

---

## ✅ 特徴と設計方針

* **逐次処理**：1行ずつ翻訳・出力
* **再実行耐性**：中断後も途中行から再開可能
* **拡張性**：他ジャンル・他APIへの対応も見据えた構成

---

## 🔮 今後の拡張予定

* **訳語キャッシュ機能**：別ファイルで再利用
* **失敗行の再翻訳モード**
* **CLI／GUI化**：ユーザビリティ向上

---

## 📌 まとめ

Danbooru API と AI 翻訳を活用し、英語タグ→日本語キャラ名への自動翻訳辞書を構築するツール。
再利用可能な設定ファイルにより、実行環境や対象ジャンルの変更にも柔軟に対応可能。
**信頼性・拡張性・実用性**のバランスを備えた構成を目指す。

---
